<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: TaliaCore::ActiveSourceParts::Rdf::RdfReader</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">TaliaCore::ActiveSourceParts::Rdf::RdfReader</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../../files/lib/talia_core/active_source_parts/rdf/rdf_reader_rb.html">
                lib/talia_core/active_source_parts/rdf/rdf_reader.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="../../../Object.html">
                Object
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
Import class for rdf ntriples files using rdf.rb (<a
href="http://rdf.rubyforge.org">rdf.rubyforge.org</a>/). See GenericReader
for more information on Talia import classes in general.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000099">format</a>&nbsp;&nbsp;
      <a href="#M000095">new</a>&nbsp;&nbsp;
      <a href="#M000098">rdf_to_talia_type</a>&nbsp;&nbsp;
      <a href="#M000096">sources</a>&nbsp;&nbsp;
      <a href="#M000094">sources_from</a>&nbsp;&nbsp;
      <a href="#M000093">sources_from_url</a>&nbsp;&nbsp;
      <a href="#M000097">update_source_type</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->
    <div id="includes">
      <h3 class="section-bar">Included Modules</h3>

      <div id="includes-list">
        <span class="include-name"><a href="../../../TaliaUtil/IoHelper.html">TaliaUtil::IoHelper</a></span>
        <span class="include-name"><a href="../../../TaliaUtil/Progressable.html">TaliaUtil::Progressable</a></span>
      </div>
    </div>

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000095" class="method-detail">
        <a name="M000095"></a>

        <div class="method-heading">
          <a href="#M000095" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(source)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
On inititalization:
</p>
<ul>
<li>We are going to use Class.subclasses_of method to determine the talia type
of the source. Due to the autoload functionality of rails we need to be
sure any possible source type class file is loaded when we actually use
that method. This is what TaliaUtil::Util::load_all_models does.

</li>
<li>Works only with format=:ntriples for now.

</li>
</ul>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000095-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000095-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/active_source_parts/rdf/rdf_reader.rb, line 35</span>
35:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">source</span>)
36:           <span class="ruby-constant">TaliaUtil</span><span class="ruby-operator">::</span><span class="ruby-constant">Util</span>.<span class="ruby-identifier">load_all_models</span>
37:           <span class="ruby-identifier">source</span> = <span class="ruby-constant">StringIO</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">source</span>) <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">source</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">String</span>)
38:           <span class="ruby-ivar">@reader</span> = <span class="ruby-constant">RDF</span><span class="ruby-operator">::</span><span class="ruby-constant">Reader</span>.<span class="ruby-identifier">for</span>(<span class="ruby-identifier">format</span>).<span class="ruby-identifier">new</span>(<span class="ruby-identifier">source</span>)
39:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000094" class="method-detail">
        <a name="M000094"></a>

        <div class="method-heading">
          <a href="#M000094" class="method-signature">
          <span class="method-name">sources_from</span><span class="method-args">(source, progressor=nil, base_url=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See TaliaCore::ActiveSourceParts::Xml::GenericReader#sources_from
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000094-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000094-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/active_source_parts/rdf/rdf_reader.rb, line 22</span>
22:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sources_from</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">progressor</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">base_url</span>=<span class="ruby-keyword kw">nil</span>)
23:             <span class="ruby-identifier">reader</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">source</span>)
24:             <span class="ruby-identifier">reader</span>.<span class="ruby-identifier">progressor</span> = <span class="ruby-identifier">progressor</span>
25:             <span class="ruby-identifier">reader</span>.<span class="ruby-identifier">sources</span>
26:           <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000093" class="method-detail">
        <a name="M000093"></a>

        <div class="method-heading">
          <a href="#M000093" class="method-signature">
          <span class="method-name">sources_from_url</span><span class="method-args">(url, options=nil, progressor=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See TaliaCore::ActiveSourceParts::Xml::GenericReader#sources_from_url
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000093-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000093-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/active_source_parts/rdf/rdf_reader.rb, line 17</span>
17:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sources_from_url</span>(<span class="ruby-identifier">url</span>, <span class="ruby-identifier">options</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">progressor</span>=<span class="ruby-keyword kw">nil</span>)
18:             <span class="ruby-identifier">open_generic</span>(<span class="ruby-identifier">url</span>, <span class="ruby-identifier">options</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span> <span class="ruby-identifier">sources_from</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">progressor</span>, <span class="ruby-identifier">url</span>)}
19:           <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000099" class="method-detail">
        <a name="M000099"></a>

        <div class="method-heading">
          <a href="#M000099" class="method-signature">
          <span class="method-name">format</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000099-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000099-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/active_source_parts/rdf/rdf_reader.rb, line 92</span>
92:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">format</span>
93:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">NotImplementedError</span>
94:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000098" class="method-detail">
        <a name="M000098"></a>

        <div class="method-heading">
          <a href="#M000098" class="method-signature">
          <span class="method-name">rdf_to_talia_type</span><span class="method-args">(rdf_type)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Tries to gues at the talia type of a source given its rdf type.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000098-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000098-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/active_source_parts/rdf/rdf_reader.rb, line 86</span>
86:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rdf_to_talia_type</span>(<span class="ruby-identifier">rdf_type</span>)
87:           <span class="ruby-constant">Class</span>.<span class="ruby-identifier">subclasses_of</span>(<span class="ruby-constant">TaliaCore</span><span class="ruby-operator">::</span><span class="ruby-constant">ActiveSource</span>).<span class="ruby-identifier">detect</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
88:             <span class="ruby-identifier">c</span>.<span class="ruby-identifier">additional_rdf_types</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">rdf_type</span>
89:           <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">try</span> <span class="ruby-identifier">:name</span>
90:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000096" class="method-detail">
        <a name="M000096"></a>

        <div class="method-heading">
          <a href="#M000096" class="method-signature">
          <span class="method-name">sources</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See TaliaCore::ActiveSourceParts::Xml::GenericReader#sources
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000096-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000096-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/active_source_parts/rdf/rdf_reader.rb, line 42</span>
42:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sources</span>
43:           <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@sources</span> <span class="ruby-keyword kw">if</span>(<span class="ruby-ivar">@sources</span>)
44:           <span class="ruby-ivar">@sources</span> = {}
45:           <span class="ruby-identifier">run_with_progress</span>(<span class="ruby-value str">'RdfRead'</span>, <span class="ruby-value">0</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">progress</span><span class="ruby-operator">|</span>
46:             <span class="ruby-ivar">@reader</span>.<span class="ruby-identifier">each_statement</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">statement</span><span class="ruby-operator">|</span>
47:               <span class="ruby-identifier">source</span> = (<span class="ruby-ivar">@sources</span>[<span class="ruby-identifier">statement</span>.<span class="ruby-identifier">subject</span>.<span class="ruby-identifier">to_s</span>] <span class="ruby-operator">||=</span> {})
48:               <span class="ruby-identifier">source</span>[<span class="ruby-value str">'uri'</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">statement</span>.<span class="ruby-identifier">subject</span>.<span class="ruby-identifier">to_s</span>
49:               <span class="ruby-identifier">update_source_type</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">statement</span>)
50:               <span class="ruby-identifier">source</span>[<span class="ruby-identifier">statement</span>.<span class="ruby-identifier">predicate</span>.<span class="ruby-identifier">to_s</span>] <span class="ruby-operator">||=</span> []
51:               <span class="ruby-identifier">object</span> = <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">statement</span>.<span class="ruby-identifier">object</span>.<span class="ruby-identifier">literal?</span>)
52:                          <span class="ruby-identifier">parsed_string</span> = <span class="ruby-constant">PropertyString</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">statement</span>.<span class="ruby-identifier">object</span>.<span class="ruby-identifier">value</span>)
53:                          <span class="ruby-identifier">parsed_string</span>.<span class="ruby-identifier">lang</span> = <span class="ruby-identifier">statement</span>.<span class="ruby-identifier">object</span>.<span class="ruby-identifier">language</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">statement</span>.<span class="ruby-identifier">object</span>.<span class="ruby-identifier">language</span>)
54:                          <span class="ruby-identifier">parsed_string</span>
55:                        <span class="ruby-keyword kw">else</span>
56:                          <span class="ruby-node">&quot;&lt;#{statement.object.to_s}&gt;&quot;</span>
57:                        <span class="ruby-keyword kw">end</span>
58:               <span class="ruby-identifier">source</span>[<span class="ruby-identifier">statement</span>.<span class="ruby-identifier">predicate</span>.<span class="ruby-identifier">to_s</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">object</span>
59:               <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">inc</span>
60:             <span class="ruby-keyword kw">end</span>
61:           <span class="ruby-keyword kw">end</span>
62:           <span class="ruby-comment cmt"># Set all empty source types to ActiveSource, to prevent DummySource type objects to</span>
63:           <span class="ruby-comment cmt"># be created. (Reason: When we import RDF, we assume that all sources are &quot;valid&quot;, and should</span>
64:           <span class="ruby-comment cmt"># never be marked as DummySource)</span>
65:           <span class="ruby-ivar">@sources</span> = <span class="ruby-ivar">@sources</span>.<span class="ruby-identifier">values</span>
66:           <span class="ruby-ivar">@sources</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>[<span class="ruby-value str">'type'</span>] <span class="ruby-operator">||=</span> <span class="ruby-value str">'TaliaCore::ActiveSource'</span> }
67:           <span class="ruby-ivar">@sources</span>
68:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000097" class="method-detail">
        <a name="M000097"></a>

        <div class="method-heading">
          <a href="#M000097" class="method-signature">
          <span class="method-name">update_source_type</span><span class="method-args">(source, statement)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Update the Talia source type. The type can be contained explicitly as
object of a N::TALIA.type predicate or can be inferred from the rdf type if
a N::RDF.type predicate is present.
</p>
<p>
The method works in the way that a N::TALIA type attribute always
overwrites the type, while an N::RDF.type will only be used if no type has
been set on the source
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000097-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000097-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/active_source_parts/rdf/rdf_reader.rb, line 75</span>
75:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_source_type</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">statement</span>)
76:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">statement</span>.<span class="ruby-identifier">object</span>.<span class="ruby-identifier">literal?</span>)
77:           <span class="ruby-keyword kw">case</span>(<span class="ruby-identifier">statement</span>.<span class="ruby-identifier">predicate</span>.<span class="ruby-identifier">to_s</span>)
78:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">N</span><span class="ruby-operator">::</span><span class="ruby-constant">TALIA</span>.<span class="ruby-identifier">type</span>.<span class="ruby-identifier">to_s</span>
79:             <span class="ruby-identifier">source</span>[<span class="ruby-value str">'type'</span>] = <span class="ruby-identifier">statement</span>.<span class="ruby-identifier">object</span>.<span class="ruby-identifier">to_s</span>
80:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">N</span><span class="ruby-operator">::</span><span class="ruby-constant">RDF</span>.<span class="ruby-identifier">type</span>.<span class="ruby-identifier">to_s</span>
81:             <span class="ruby-identifier">source</span>[<span class="ruby-value str">'type'</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">rdf_to_talia_type</span> <span class="ruby-identifier">statement</span>.<span class="ruby-identifier">object</span>.<span class="ruby-identifier">to_s</span>
82:           <span class="ruby-keyword kw">end</span>
83:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>